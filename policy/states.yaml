# ═══════════════════════════════════════════════════════════════════════════
# ESCALATION STATES — The state machine for your countdown
# ═══════════════════════════════════════════════════════════════════════════
#
# ┌──────────────────────────────────────────────────────────────────────────┐
# │  STATE FLOW (automatic progression when deadline approaches/passes):    │
# │                                                                          │
# │  OK → REMIND_1 → REMIND_2 → PRE_RELEASE → PARTIAL → FULL               │
# │  ↑                                                                       │
# │  └──── RENEWAL resets back to OK at any point                           │
# └──────────────────────────────────────────────────────────────────────────┘
#
# Each state can trigger different actions (defined in plans/default.yaml)
#
# ═══════════════════════════════════════════════════════════════════════════

version: 1

notes:
  - States are ordered - the engine only moves forward unless a rule resets.
  - Each state can define what kind of actions are allowed.
  - Actual actions for each state are configured in plans/default.yaml.

states:
  - name: OK
    order: 0
    description: Countdown is healthy. No outward actions required.
    flags:
      outward_actions_allowed: false
      reminders_allowed: false

  - name: REMIND_1
    order: 10
    description: First reminder stage. Notify operator to renew before deadline.
    flags:
      outward_actions_allowed: false
      reminders_allowed: true

  - name: REMIND_2
    order: 20
    description: Second reminder stage. Stronger reminder via secondary channel if configured.
    flags:
      outward_actions_allowed: false
      reminders_allowed: true

  - name: PRE_RELEASE
    order: 30
    description: Final warning stage. Notify preconfigured custodians that escalation is imminent.
    flags:
      outward_actions_allowed: false
      reminders_allowed: true

  - name: PARTIAL
    order: 40
    description: Limited outward execution. First wave of public/third-party actions.
    flags:
      outward_actions_allowed: true
      reminders_allowed: true

  - name: FULL
    order: 50
    description: Full execution. All configured outward actions fire per plan.
    flags:
      outward_actions_allowed: true
      reminders_allowed: true

terminal_states:
  - FULL

reset_behavior:
  on_successful_renewal:
    target_state: OK
    description: Successful renewal returns the system to OK and resets stage progression.
  on_manual_disable:
    target_state: OK
    description: If a disable mechanism exists in the chosen mode, it returns to OK.

stage_progression_defaults:
  - from: OK
    to: REMIND_1
  - from: REMIND_1
    to: REMIND_2
  - from: REMIND_2
    to: PRE_RELEASE
  - from: PRE_RELEASE
    to: PARTIAL
  - from: PARTIAL
    to: FULL
