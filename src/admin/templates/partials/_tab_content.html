<!-- Content Tab -->
<div id="tab-content" class="tab-content">
    <header class="header">
        <h1>üìù Content</h1>
        <p class="subtitle">Author, encrypt, and manage article content</p>
    </header>

    <!-- Encryption key status bar -->
    <div id="content-key-bar" class="card full-width" style="margin-bottom: 1.5rem; padding: 0.75rem 1.25rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
            <div id="content-key-status" style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                <span class="loading">Checking encryption key</span>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn" id="content-gen-key-btn" onclick="contentGenerateKey()"
                    style="padding: 0.35rem 0.75rem; font-size: 0.82rem;" title="Generate a new encryption key">
                    üîë Generate Key
                </button>
            </div>
        </div>
    </div>

    <div class="grid" style="grid-template-columns: 340px 1fr;">
        <!-- ‚ïê‚ïê‚ïê LEFT SIDEBAR ‚ïê‚ïê‚ïê -->
        <div class="card" id="content-list-card" style="align-self: start;">
            <!-- Sidebar mode toggle: Articles / Media -->
            <div class="content-mode-toggle" style="display: flex; gap: 2px; background: var(--bg-input); border-radius: 8px; padding: 3px; margin-bottom: 1rem;">
                <button id="content-mode-articles" class="content-mode-btn active"
                    onclick="contentSwitchMode('articles')" title="Manage articles">
                    üìÑ Articles
                </button>
                <button id="content-mode-media" class="content-mode-btn"
                    onclick="contentSwitchMode('media')" title="Manage media files">
                    üñºÔ∏è Media
                </button>
            </div>

            <!-- ‚îÄ‚îÄ Articles list (default) ‚îÄ‚îÄ -->
            <div id="content-sidebar-articles">
                <h2 style="display: flex; align-items: center; justify-content: space-between;">
                    <span><span class="icon">üìÑ</span> Articles</span>
                    <button class="btn" onclick="contentNewArticle()" style="padding: 0.3rem 0.6rem; font-size: 0.78rem;"
                        title="Create new article">
                        ‚ûï New
                    </button>
                </h2>
                <div id="content-article-list">
                    <div class="loading">Loading articles</div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ Media gallery (hidden by default) ‚îÄ‚îÄ -->
            <div id="content-sidebar-media" style="display: none;">
                <h2 style="display: flex; align-items: center; justify-content: space-between;">
                    <span><span class="icon">üñºÔ∏è</span> Media</span>
                    <button class="btn" onclick="mediaUploadPrompt()" style="padding: 0.3rem 0.6rem; font-size: 0.78rem;"
                        title="Upload media file">
                        üì§ Upload
                    </button>
                </h2>
                <div id="media-summary" style="font-size: 0.78rem; color: var(--text-dim); margin-bottom: 0.75rem;"></div>
                <div id="media-gallery-list">
                    <div class="loading">Loading media</div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê RIGHT PANEL ‚ïê‚ïê‚ïê -->

        <!-- ‚îÄ‚îÄ Article editor (default) ‚îÄ‚îÄ -->
        <div class="card" id="content-editor-card" style="display: flex; flex-direction: column; min-height: 500px;">
            <h2 id="content-editor-title" style="display: flex; align-items: center; justify-content: space-between;">
                <span><span class="icon">‚úèÔ∏è</span> <span id="content-editor-slug">Select an article</span></span>
                <div id="content-editor-badges" style="display: flex; gap: 0.35rem;"></div>
            </h2>

            <!-- No article selected state -->
            <div id="content-editor-empty"
                style="flex: 1; display: flex; align-items: center; justify-content: center; color: var(--text-dim);">
                <div style="text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 0.75rem; opacity: 0.3;">üìù</div>
                    <p>Select an article from the list, or create a new one.</p>
                </div>
            </div>

            <!-- Editor.js container (hidden until article selected) -->
            <div id="content-editorjs-wrap" style="display: none; flex: 1;">
                <div id="content-editorjs"
                    style="border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; min-height: 350px; background: var(--bg-input);">
                </div>
            </div>

            <!-- Editor controls (hidden until article selected) -->
            <div id="content-editor-controls"
                style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <div
                    style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.75rem;">
                    <!-- Left: encryption toggle -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <label
                            style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" id="content-encrypt-toggle" style="accent-color: var(--accent);">
                            <span>üîí Save encrypted</span>
                        </label>
                        <span id="content-encrypt-note" style="font-size: 0.78rem; color: var(--text-dim);"></span>
                    </div>
                    <!-- Right: action buttons -->
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn" onclick="contentDeleteArticle()"
                            style="padding: 0.45rem 0.9rem; color: var(--danger);" title="Delete this article">
                            üóëÔ∏è Delete
                        </button>
                        <button class="btn" onclick="contentDiscard()" style="padding: 0.45rem 0.9rem;">
                            ‚Ü©Ô∏è Discard
                        </button>
                        <button class="btn primary" onclick="contentSave()" id="content-save-btn"
                            style="padding: 0.45rem 0.9rem;">
                            üíæ Save
                        </button>
                    </div>
                </div>
            </div>

            <!-- Metadata panel (hidden until article selected) -->
            <div id="content-meta-panel"
                style="display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border);">
                <details style="font-size: 0.85rem;">
                    <summary style="color: var(--text-dim); cursor: pointer; user-select: none;">‚öôÔ∏è Article Settings
                    </summary>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 0.75rem;">
                        <div>
                            <label class="form-label" style="font-size: 0.78rem;">Minimum Stage</label>
                            <select class="form-input" id="content-meta-stage" style="padding: 0.45rem;">
                                <option value="OK">OK (always visible)</option>
                                <option value="WARNING">WARNING</option>
                                <option value="CRITICAL">CRITICAL</option>
                                <option value="FINAL">FINAL</option>
                                <option value="FULL" selected>FULL (disclosure only)</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.78rem;">Navigation</label>
                            <div style="display: flex; flex-direction: column; gap: 0.35rem; margin-top: 0.3rem;">
                                <label
                                    style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.82rem; cursor: pointer;">
                                    <input type="checkbox" id="content-meta-nav" checked
                                        style="accent-color: var(--accent);">
                                    Include in nav
                                </label>
                                <label
                                    style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.82rem; cursor: pointer;">
                                    <input type="checkbox" id="content-meta-pin" style="accent-color: var(--accent);">
                                    Pin to top
                                </label>
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Media panel (hidden by default) ‚îÄ‚îÄ -->
        <div class="card" id="media-panel-card" style="display: none; flex-direction: column; min-height: 500px;">
            <h2 id="media-panel-title" style="display: flex; align-items: center; justify-content: space-between;">
                <span><span class="icon">üñºÔ∏è</span> <span id="media-panel-name">Upload or select media</span></span>
                <div id="media-panel-badges" style="display: flex; gap: 0.35rem;"></div>
            </h2>

            <!-- No media selected ‚Äî upload dropzone -->
            <div id="media-upload-zone"
                style="flex: 1; display: flex; align-items: center; justify-content: center;">
                <div id="media-dropzone" class="media-dropzone">
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 0.75rem; opacity: 0.4;">üì§</div>
                        <p style="font-size: 0.95rem; margin-bottom: 0.5rem;">Drop a file here, or click to upload</p>
                        <p style="font-size: 0.78rem; color: var(--text-dim);">
                            Images, PDFs, video, audio ‚Äî max 10 MB
                        </p>
                        <input type="file" id="media-file-input" style="display: none;"
                            accept="image/*,video/*,audio/*,application/pdf" onchange="mediaFileSelected(event)">
                        <button class="btn" onclick="document.getElementById('media-file-input').click()"
                            style="margin-top: 1rem; padding: 0.5rem 1.5rem;">
                            üìÅ Choose File
                        </button>
                    </div>
                </div>
            </div>

            <!-- Upload options (shown after file selected, before upload) -->
            <div id="media-upload-options" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                    <div>
                        <label class="form-label" style="font-size: 0.78rem;">Minimum Stage</label>
                        <select class="form-input" id="media-upload-stage" style="padding: 0.45rem;">
                            <option value="OK">OK (always visible)</option>
                            <option value="REMIND_1">REMIND_1</option>
                            <option value="REMIND_2">REMIND_2</option>
                            <option value="PRE_RELEASE">PRE_RELEASE</option>
                            <option value="PARTIAL">PARTIAL</option>
                            <option value="FULL" selected>FULL (disclosure only)</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label" style="font-size: 0.78rem;">Caption (optional)</label>
                        <input class="form-input" id="media-upload-caption" type="text" placeholder="Describe this media"
                            style="padding: 0.45rem;">
                    </div>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem;">
                    <div id="media-upload-file-info" style="font-size: 0.82rem; color: var(--text-dim);"></div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn" onclick="mediaCancelUpload()" style="padding: 0.45rem 0.9rem;">
                            ‚úï Cancel
                        </button>
                        <button class="btn primary" id="media-upload-btn" onclick="mediaDoUpload()"
                            style="padding: 0.45rem 0.9rem;">
                            üì§ Encrypt & Upload
                        </button>
                    </div>
                </div>
            </div>

            <!-- Media detail view (shown when media selected from gallery) -->
            <div id="media-detail-view" style="display: none; flex: 1; flex-direction: column;">
                <!-- Preview area -->
                <div id="media-detail-preview"
                    style="flex: 1; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-input); min-height: 250px; overflow: hidden;">
                </div>
                <!-- Media info + actions -->
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
                        <div>
                            <div style="color: var(--text-dim); font-size: 0.75rem; margin-bottom: 0.2rem;">Media URI</div>
                            <div style="display: flex; align-items: center; gap: 0.4rem;">
                                <code id="media-detail-uri" style="font-size: 0.82rem; color: var(--accent);"></code>
                                <button class="btn" onclick="mediaCopyUri()" title="Copy media URI"
                                    style="padding: 0.15rem 0.4rem; font-size: 0.72rem;">üìã</button>
                            </div>
                        </div>
                        <div>
                            <div style="color: var(--text-dim); font-size: 0.75rem; margin-bottom: 0.2rem;">Details</div>
                            <div id="media-detail-info" style="font-size: 0.82rem;"></div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 0.75rem;">
                        <div>
                            <label class="form-label" style="font-size: 0.78rem;">Minimum Stage</label>
                            <select class="form-input" id="media-detail-stage" style="padding: 0.45rem;"
                                onchange="mediaUpdateField('min_stage', this.value)">
                                <option value="OK">OK</option>
                                <option value="REMIND_1">REMIND_1</option>
                                <option value="REMIND_2">REMIND_2</option>
                                <option value="PRE_RELEASE">PRE_RELEASE</option>
                                <option value="PARTIAL">PARTIAL</option>
                                <option value="FULL">FULL</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.78rem;">Caption</label>
                            <input class="form-input" id="media-detail-caption" type="text"
                                style="padding: 0.45rem;" placeholder="Add a caption"
                                onblur="mediaUpdateField('caption', this.value)">
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem;">
                        <div id="media-detail-refs" style="font-size: 0.78rem; color: var(--text-dim);"></div>
                        <button class="btn" onclick="mediaDeleteSelected()"
                            style="padding: 0.4rem 0.8rem; color: var(--danger); font-size: 0.82rem;">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status terminal -->
    <div class="card full-width" style="margin-top: 1.5rem;">
        <h2><span class="icon">üìü</span> Output</h2>
        <pre class="terminal" id="content-terminal">Ready.</pre>
    </div>
</div>