<!-- Content Tab -->
<div id="tab-content" class="tab-content">
    <header class="header">
        <h1>üìù Content</h1>
        <p class="subtitle">Author, encrypt, and manage article content</p>
    </header>

    <!-- Encryption key status bar -->
    <div id="content-key-bar" class="card full-width" style="margin-bottom: 1.5rem; padding: 0.75rem 1.25rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
            <div id="content-key-status" style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                <span class="loading">Checking encryption key</span>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn" id="content-gen-key-btn" onclick="contentGenerateKey()"
                    style="padding: 0.35rem 0.75rem; font-size: 0.82rem;" title="Generate a new encryption key">
                    üîë Generate Key
                </button>
            </div>
        </div>
    </div>

    <div class="grid" style="grid-template-columns: 340px 1fr;">
        <!-- ‚ïê‚ïê‚ïê LEFT SIDEBAR ‚ïê‚ïê‚ïê -->
        <div class="card" id="content-list-card" style="align-self: start;">
            <!-- Sidebar mode toggle: Articles / Media -->
            <div class="content-mode-toggle" style="display: flex; gap: 2px; background: var(--bg-input); border-radius: 8px; padding: 3px; margin-bottom: 1rem;">
                <button id="content-mode-articles" class="content-mode-btn active"
                    onclick="contentSwitchMode('articles')" title="Manage articles">
                    üìÑ Articles
                </button>
                <button id="content-mode-media" class="content-mode-btn"
                    onclick="contentSwitchMode('media')" title="Manage media files">
                    üñºÔ∏è Media
                </button>
                <button id="content-mode-messages" class="content-mode-btn"
                    onclick="contentSwitchMode('messages')" title="Manage notification messages">
                    ‚úâÔ∏è Messages
                </button>
            </div>

            <!-- ‚îÄ‚îÄ Articles list (default) ‚îÄ‚îÄ -->
            <div id="content-sidebar-articles">
                <h2 style="display: flex; align-items: center; justify-content: space-between;">
                    <span><span class="icon">üìÑ</span> Articles</span>
                    <button class="btn" onclick="contentNewArticle()" style="padding: 0.3rem 0.6rem; font-size: 0.78rem;"
                        title="Create new article">
                        ‚ûï New
                    </button>
                </h2>
                <div id="content-article-list">
                    <div class="loading">Loading articles</div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ Media gallery (hidden by default) ‚îÄ‚îÄ -->
            <div id="content-sidebar-media" style="display: none;">
                <h2 style="display: flex; align-items: center; justify-content: space-between;">
                    <span><span class="icon">üñºÔ∏è</span> Media</span>
                    <button class="btn" onclick="mediaUploadPrompt()" style="padding: 0.3rem 0.6rem; font-size: 0.78rem;"
                        title="Upload media file">
                        üì§ Upload
                    </button>
                </h2>
                <div id="media-summary" style="font-size: 0.78rem; color: var(--text-dim); margin-bottom: 0.75rem;"></div>
                <div id="media-gallery-list">
                    <div class="loading">Loading media</div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ Messages list (hidden by default) ‚îÄ‚îÄ -->
            <div id="content-sidebar-messages" style="display: none;">
                <h2 style="display: flex; align-items: center; justify-content: space-between;">
                    <span><span class="icon">‚úâÔ∏è</span> Messages</span>
                    <button class="btn" onclick="messagesNew()" style="padding: 0.3rem 0.6rem; font-size: 0.78rem;"
                        title="Create new message">
                        ‚ûï New
                    </button>
                </h2>
                <div id="messages-list">
                    <div class="loading">Loading messages</div>
                </div>

                <!-- Recipient lists -->
                <div id="messages-recipients" style="margin-top: 1.25rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                    <div style="font-size: 0.82rem; font-weight: 600; color: var(--text-dim); margin-bottom: 0.5rem;">üì¨ Subscriber Emails</div>
                    <div id="messages-subscribers-list" style="margin-bottom: 0.5rem;"></div>
                    <div style="display: flex; gap: 0.35rem;">
                        <input class="form-input" id="messages-add-subscriber" type="email" placeholder="email@example.com"
                            style="padding: 0.35rem 0.5rem; font-size: 0.78rem; flex: 1;">
                        <button class="btn" onclick="messagesAddRecipient('subscriber')" style="padding: 0.3rem 0.5rem; font-size: 0.72rem;">+ Add</button>
                    </div>

                    <div style="font-size: 0.82rem; font-weight: 600; color: var(--text-dim); margin-top: 1rem; margin-bottom: 0.5rem;">üõ°Ô∏è Custodian Emails</div>
                    <div id="messages-custodians-list" style="margin-bottom: 0.5rem;"></div>
                    <div style="display: flex; gap: 0.35rem;">
                        <input class="form-input" id="messages-add-custodian" type="email" placeholder="email@example.com"
                            style="padding: 0.35rem 0.5rem; font-size: 0.78rem; flex: 1;">
                        <button class="btn" onclick="messagesAddRecipient('custodian')" style="padding: 0.3rem 0.5rem; font-size: 0.72rem;">+ Add</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê RIGHT PANEL ‚ïê‚ïê‚ïê -->

        <!-- ‚îÄ‚îÄ Article editor (default) ‚îÄ‚îÄ -->
        <div class="card" id="content-editor-card" style="display: flex; flex-direction: column; min-height: 500px;">
            <h2 id="content-editor-title" style="display: flex; align-items: center; justify-content: space-between;">
                <span><span class="icon">‚úèÔ∏è</span> <span id="content-editor-slug" translate="no">Select an article</span></span>
                <div id="content-editor-badges" translate="no" style="display: flex; gap: 0.35rem;"></div>
            </h2>

            <!-- No article selected state -->
            <div id="content-editor-empty"
                style="flex: 1; display: flex; align-items: center; justify-content: center; color: var(--text-dim);">
                <div style="text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 0.75rem; opacity: 0.3;">üìù</div>
                    <p>Select an article from the list, or create a new one.</p>
                </div>
            </div>

            <!-- Editor.js container (hidden until article selected) -->
            <div id="content-editorjs-wrap" style="display: none; flex: 1;">
                <!-- Insert Media toolbar -->
                <div id="content-media-toolbar" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <button class="btn" onclick="openVaultPicker()" title="Browse vault media or upload a file"
                        style="padding: 0.35rem 0.75rem; font-size: 0.82rem;">
                        üìé Insert Media
                    </button>
                </div>
                <div id="content-editorjs" translate="no"
                    style="border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; min-height: 350px; background: var(--bg-input);">
                </div>
            </div>

            <!-- Editor controls (hidden until article selected) -->
            <div id="content-editor-controls"
                style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <div
                    style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.75rem;">
                    <!-- Left: encryption toggle -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <label
                            style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" id="content-encrypt-toggle" style="accent-color: var(--accent);">
                            <span>üîí Save encrypted</span>
                        </label>
                        <span id="content-encrypt-note" style="font-size: 0.78rem; color: var(--text-dim);"></span>
                    </div>
                    <!-- Right: action buttons -->
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <span id="content-save-status"
                            style="font-size: 0.78rem; color: var(--accent); opacity: 0; transition: opacity 0.3s;"></span>
                        <button class="btn" onclick="contentDeleteArticle()"
                            style="padding: 0.45rem 0.9rem; color: var(--danger);" title="Delete this article">
                            üóëÔ∏è Delete
                        </button>
                        <button class="btn" onclick="contentDiscard()" style="padding: 0.45rem 0.9rem;">
                            ‚Ü©Ô∏è Discard
                        </button>
                        <button class="btn primary" onclick="contentSave()" id="content-save-btn"
                            style="padding: 0.45rem 0.9rem;">
                            üíæ Save
                        </button>
                    </div>
                </div>
            </div>

            <!-- Metadata panel (hidden until article selected) -->
            <div id="content-meta-panel"
                style="display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border);">
                <details style="font-size: 0.85rem;">
                    <summary style="color: var(--text-dim); cursor: pointer; user-select: none;">‚öôÔ∏è Article Settings
                    </summary>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 0.75rem;">
                        <div>
                            <label class="form-label" style="font-size: 0.78rem;">Minimum Stage</label>
                            <select class="form-input" id="content-meta-stage" style="padding: 0.45rem;">
                                <option value="OK">OK (always visible)</option>
                                <option value="WARNING">WARNING</option>
                                <option value="CRITICAL">CRITICAL</option>
                                <option value="FINAL">FINAL</option>
                                <option value="FULL" selected>FULL (disclosure only)</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.78rem;">Navigation</label>
                            <div style="display: flex; flex-direction: column; gap: 0.35rem; margin-top: 0.3rem;">
                                <label
                                    style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.82rem; cursor: pointer;">
                                    <input type="checkbox" id="content-meta-nav" checked
                                        style="accent-color: var(--accent);">
                                    Include in nav
                                </label>
                                <label
                                    style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.82rem; cursor: pointer;">
                                    <input type="checkbox" id="content-meta-pin" style="accent-color: var(--accent);">
                                    Pin to top
                                </label>
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Media panel (hidden by default) ‚îÄ‚îÄ -->
        <div class="card" id="media-panel-card" style="display: none; flex-direction: column; min-height: 500px;">
            <h2 id="media-panel-title" style="display: flex; align-items: center; justify-content: space-between;">
                <span><span class="icon">üñºÔ∏è</span> <span id="media-panel-name">Upload or select media</span></span>
                <div id="media-panel-badges" translate="no" style="display: flex; gap: 0.35rem;"></div>
            </h2>

            <!-- No media selected ‚Äî upload dropzone -->
            <div id="media-upload-zone"
                style="flex: 1; display: flex; align-items: center; justify-content: center;">
                <div id="media-dropzone" class="media-dropzone">
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 0.75rem; opacity: 0.4;">üì§</div>
                        <p style="font-size: 0.95rem; margin-bottom: 0.5rem;">Drop a file here, or click to upload</p>
                        <p style="font-size: 0.78rem; color: var(--text-dim);">
                            Images, PDFs, video, audio ‚Äî up to 1 GB
                        </p>
                        <input type="file" id="media-file-input" style="display: none;"
                            accept="image/*,video/*,audio/*,application/pdf,text/*,.json,.xml,.eml,.msg,.csv,.md,.zip,.gz,.tar,.7z,.mkv,.webm,.mov,.avi"
                            onchange="mediaFileSelected(event)">
                        <button class="btn" onclick="document.getElementById('media-file-input').click()"
                            style="margin-top: 1rem; padding: 0.5rem 1.5rem;">
                            üìÅ Choose File
                        </button>
                    </div>
                </div>

                <!-- Multi-stage progress (hidden until upload starts) -->
                <div id="media-upload-progress" style="display: none; width: 100%; padding: 1.5rem;">
                    <div id="media-progress-stage-label" style="font-size: 0.85rem; font-weight: 500; margin-bottom: 0.5rem;">Uploading...</div>
                    <div style="position: relative; height: 6px; background: var(--surface-alt, #2a2a3a); border-radius: 3px; overflow: hidden;">
                        <div id="media-progress-bar" style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), #60a5fa); border-radius: 3px; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.4rem;">
                        <span id="media-progress-detail" style="font-size: 0.75rem; color: var(--text-dim);">0%</span>
                        <span id="media-progress-eta" style="font-size: 0.75rem; color: var(--text-dim);"></span>
                    </div>
                    <!-- Stage indicators -->
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.75rem;">
                        <div id="media-stage-upload" class="media-stage-indicator active" style="flex: 1; text-align: center; font-size: 0.72rem; padding: 0.3rem; border-radius: 4px; background: var(--surface-alt, #2a2a3a);">
                            üì§ Upload
                        </div>
                        <div id="media-stage-optimize" class="media-stage-indicator" style="flex: 1; text-align: center; font-size: 0.72rem; padding: 0.3rem; border-radius: 4px; background: var(--surface-alt, #2a2a3a); opacity: 0.4;">
                            ‚öôÔ∏è Optimize
                        </div>
                        <div id="media-stage-release" class="media-stage-indicator" style="flex: 1; text-align: center; font-size: 0.72rem; padding: 0.3rem; border-radius: 4px; background: var(--surface-alt, #2a2a3a); opacity: 0.4;">
                            ‚òÅÔ∏è Release
                        </div>
                    </div>
                    <!-- Cancel button -->
                    <div style="text-align: center; margin-top: 0.75rem;">
                        <button id="media-cancel-btn" class="btn" onclick="mediaCancelUploadInProgress()"
                            style="padding: 0.35rem 1rem; font-size: 0.78rem; opacity: 0.7;">
                            ‚úï Cancel
                        </button>
                    </div>
                </div>
            </div>

            <!-- Upload options (shown after file selected, before upload) -->
            <div id="media-upload-options" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                    <div>
                        <label class="form-label" style="font-size: 0.78rem;">Minimum Stage</label>
                        <select class="form-input" id="media-upload-stage" style="padding: 0.45rem;">
                            <option value="OK">OK (always visible)</option>
                            <option value="REMIND_1">REMIND_1</option>
                            <option value="REMIND_2">REMIND_2</option>
                            <option value="PRE_RELEASE">PRE_RELEASE</option>
                            <option value="PARTIAL">PARTIAL</option>
                            <option value="FULL" selected>FULL (disclosure only)</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label" style="font-size: 0.78rem;">Caption (optional)</label>
                        <input class="form-input" id="media-upload-caption" type="text" placeholder="Describe this media"
                            style="padding: 0.45rem;">
                    </div>
                </div>
                <!-- Encryption toggle -->
                <div style="margin-top: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.82rem; cursor: pointer;">
                        <input type="checkbox" id="media-upload-encrypt" style="accent-color: var(--accent);">
                        üîí Encrypt file at rest
                    </label>
                    <span style="font-size: 0.72rem; color: var(--text-dim);">(requires CONTENT_ENCRYPTION_KEY)</span>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem;">
                    <div id="media-upload-file-info" style="font-size: 0.82rem; color: var(--text-dim);"></div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn" onclick="mediaCancelUpload()" style="padding: 0.45rem 0.9rem;">
                            ‚úï Cancel
                        </button>
                        <button class="btn primary" id="media-upload-btn" onclick="mediaDoUpload()"
                            style="padding: 0.45rem 0.9rem;">
                            üì§ Upload
                        </button>
                    </div>
                </div>
            </div>

            <!-- Media detail view (shown when media selected from gallery) -->
            <div id="media-detail-view" style="display: none; flex: 1; flex-direction: column;">
                <!-- Preview area -->
                <div id="media-detail-preview"
                    style="flex: 1; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-input); min-height: 250px; overflow: hidden;">
                </div>
                <!-- Media info + actions -->
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
                        <div>
                            <div style="color: var(--text-dim); font-size: 0.75rem; margin-bottom: 0.2rem;">Media URI</div>
                            <div style="display: flex; align-items: center; gap: 0.4rem;">
                                <code id="media-detail-uri" translate="no" style="font-size: 0.82rem; color: var(--accent);"></code>
                                <button class="btn" onclick="mediaCopyUri()" title="Copy media URI"
                                    style="padding: 0.15rem 0.4rem; font-size: 0.72rem;">üìã</button>
                            </div>
                        </div>
                        <div>
                            <div style="color: var(--text-dim); font-size: 0.75rem; margin-bottom: 0.2rem;">Details</div>
                            <div id="media-detail-info" translate="no" style="font-size: 0.82rem;"></div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 0.75rem;">
                        <div>
                            <label class="form-label" style="font-size: 0.78rem;">Minimum Stage</label>
                            <select class="form-input" id="media-detail-stage" style="padding: 0.45rem;"
                                onchange="mediaUpdateField('min_stage', this.value)">
                                <option value="OK">OK</option>
                                <option value="REMIND_1">REMIND_1</option>
                                <option value="REMIND_2">REMIND_2</option>
                                <option value="PRE_RELEASE">PRE_RELEASE</option>
                                <option value="PARTIAL">PARTIAL</option>
                                <option value="FULL">FULL</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label" style="font-size: 0.78rem;">Caption</label>
                            <input class="form-input" id="media-detail-caption" type="text"
                                style="padding: 0.45rem;" placeholder="Add a caption"
                                onblur="mediaUpdateField('caption', this.value)">
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem;">
                        <div id="media-detail-refs" translate="no" style="font-size: 0.78rem; color: var(--text-dim);"></div>
                        <div style="display: flex; gap: 0.5rem;">
                            <a class="btn" id="media-download-btn" href="#" download
                                style="padding: 0.4rem 0.8rem; font-size: 0.82rem; text-decoration: none; display: none;">
                                ‚¨áÔ∏è Download
                            </a>
                            <button class="btn" id="media-toggle-encrypt-btn" onclick="mediaToggleEncryption()"
                                style="padding: 0.4rem 0.8rem; font-size: 0.82rem;">
                                üîí Encrypt
                            </button>
                            <button class="btn" onclick="mediaDeleteSelected()"
                                style="padding: 0.4rem 0.8rem; color: var(--danger); font-size: 0.82rem;">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Messages panel (hidden by default) ‚îÄ‚îÄ -->
        <div class="card" id="messages-panel-card" style="display: none; flex-direction: column; min-height: 600px;">
            <h2 id="messages-panel-title" style="display: flex; align-items: center; justify-content: space-between;">
                <span><span class="icon">‚úâÔ∏è</span> <span id="messages-panel-name">Select a message</span></span>
                <div id="messages-panel-badges" translate="no" style="display: flex; gap: 0.35rem;"></div>
            </h2>

            <!-- No message selected state -->
            <div id="messages-empty"
                style="flex: 1; display: flex; align-items: center; justify-content: center; color: var(--text-dim);">
                <div style="text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 0.75rem; opacity: 0.3;">‚úâÔ∏è</div>
                    <p>Select a message from the list, or create a new one.</p>
                </div>
            </div>

            <!-- Message editor + preview (hidden until message selected) -->
            <div id="messages-editor-wrap" style="display: none; flex: 1; flex-direction: column;">

                <!-- Config row: Stage / Adapter / Audience -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem;">
                    <div>
                        <label class="form-label" style="font-size: 0.78rem;">Stage</label>
                        <select class="form-input" id="messages-edit-stage" style="padding: 0.45rem;" onchange="messagesMarkDirty()">
                            <option value="REMIND_1">REMIND_1</option>
                            <option value="REMIND_2">REMIND_2</option>
                            <option value="PRE_RELEASE">PRE_RELEASE</option>
                            <option value="PARTIAL">PARTIAL</option>
                            <option value="FULL">FULL</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label" style="font-size: 0.78rem;">Adapter</label>
                        <select class="form-input" id="messages-edit-adapter" style="padding: 0.45rem;" onchange="messagesAdapterChanged()">
                            <option value="email">üìß Email</option>
                            <option value="sms">üì± SMS</option>
                            <option value="x">üê¶ X / Twitter</option>
                            <option value="reddit">ü§ñ Reddit</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label" style="font-size: 0.78rem;">Audience</label>
                        <select class="form-input" id="messages-edit-channel" style="padding: 0.45rem;" onchange="messagesMarkDirty()">
                            <option value="operator">üë§ Operator</option>
                            <option value="subscribers">üì¨ Subscribers</option>
                            <option value="custodians">üõ°Ô∏è Custodians</option>
                            <option value="public">üåê Public</option>
                        </select>
                    </div>
                </div>

                <!-- Template picker row -->
                <div style="display: flex; gap: 0.5rem; align-items: flex-end; margin-bottom: 0.75rem;">
                    <div style="flex: 1;">
                        <label class="form-label" style="font-size: 0.78rem;">Template</label>
                        <select class="form-input" id="messages-template-picker" style="padding: 0.45rem;"
                            onchange="messagesTemplatePicked()">
                            <option value="">‚Äî Pick existing template or type new ‚Äî</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <input class="form-input" id="messages-edit-template" type="text" placeholder="or type new name‚Ä¶"
                            style="padding: 0.45rem; font-family: monospace;" onchange="messagesMarkDirty()">
                    </div>
                </div>

                <!-- Split: Editor + Preview side by side -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; flex: 1; min-height: 280px;">

                    <!-- LEFT: Content editor -->
                    <div style="display: flex; flex-direction: column;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.35rem;">
                            <label class="form-label" style="font-size: 0.78rem; margin: 0;">Content</label>
                            <div id="messages-adapter-hints" style="font-size: 0.72rem; color: var(--text-dim);"></div>
                        </div>
                        <textarea class="form-input" id="messages-edit-content"
                            style="flex: 1; min-height: 200px; padding: 0.75rem; font-family: 'JetBrains Mono', 'Fira Code', monospace; font-size: 0.82rem; resize: none; line-height: 1.5; border-radius: 8px;"
                            placeholder="Write your message content here‚Ä¶" oninput="messagesContentChanged()"></textarea>

                        <!-- Variable insertion buttons -->
                        <div id="messages-var-buttons" style="margin-top: 0.4rem; display: flex; flex-wrap: wrap; gap: 0.25rem;">
                            <span style="font-size: 0.68rem; color: var(--text-dim); align-self: center; margin-right: 0.2rem;">Insert:</span>
                        </div>
                    </div>

                    <!-- RIGHT: Live preview -->
                    <div style="display: flex; flex-direction: column;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.35rem;">
                            <label class="form-label" style="font-size: 0.78rem; margin: 0;">üëÅÔ∏è Live Preview</label>
                            <span id="messages-preview-meta" style="font-size: 0.72rem; color: var(--text-dim);"></span>
                        </div>

                        <!-- Email preview (iframe) -->
                        <iframe id="messages-preview-iframe"
                            style="flex: 1; border: 1px solid var(--border); border-radius: 8px; background: #1a1a2e; min-height: 200px;"
                            sandbox="allow-same-origin"></iframe>

                        <!-- SMS preview (phone-style) -->
                        <div id="messages-preview-sms" style="display: none; flex: 1; flex-direction: column;">
                            <div style="border: 2px solid var(--border); border-radius: 16px; padding: 1.25rem; background: #0a0a0f; flex: 1; display: flex; flex-direction: column;">
                                <div style="text-align: center; font-size: 0.72rem; color: #64748b; margin-bottom: 0.75rem;">üì± SMS Preview</div>
                                <div id="messages-preview-sms-bubble"
                                    style="background: #1d4ed8; color: #fff; border-radius: 16px 16px 4px 16px; padding: 0.75rem 1rem; font-size: 0.85rem; line-height: 1.5; max-width: 85%; align-self: flex-end; word-break: break-word;">
                                </div>
                                <div id="messages-preview-sms-meta"
                                    style="margin-top: 0.5rem; text-align: right; font-size: 0.72rem; color: #64748b;">
                                </div>
                            </div>
                        </div>

                        <!-- X preview -->
                        <div id="messages-preview-x" style="display: none; flex: 1; flex-direction: column;">
                            <div style="border: 1px solid var(--border); border-radius: 12px; padding: 1rem; background: var(--bg-input); flex: 1;">
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent);"></div>
                                    <div>
                                        <div style="font-size: 0.82rem; font-weight: 600;">Project Account</div>
                                        <div style="font-size: 0.72rem; color: var(--text-dim);">@project</div>
                                    </div>
                                </div>
                                <div id="messages-preview-x-text" style="font-size: 0.9rem; line-height: 1.5; white-space: pre-wrap;"></div>
                                <div id="messages-preview-x-meta" style="margin-top: 0.75rem; font-size: 0.72rem; color: var(--text-dim);"></div>
                            </div>
                        </div>

                        <!-- Reddit preview -->
                        <div id="messages-preview-reddit" style="display: none; flex: 1; flex-direction: column;">
                            <div style="border: 1px solid var(--border); border-radius: 8px; background: var(--bg-input); flex: 1; padding: 1rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.5rem;">
                                    <span>ü§ñ</span>
                                    <span style="font-size: 0.75rem; color: var(--text-dim);">r/target ‚Ä¢ Posted by u/bot</span>
                                </div>
                                <div id="messages-preview-reddit-title" style="font-size: 1rem; font-weight: 700; margin-bottom: 0.5rem;"></div>
                                <div id="messages-preview-reddit-body" style="font-size: 0.85rem; line-height: 1.5; white-space: pre-wrap; color: var(--text-dim);"></div>
                            </div>
                        </div>

                        <!-- Generic / article preview -->
                        <div id="messages-preview-generic" style="display: none; flex: 1; flex-direction: column;">
                            <div id="messages-preview-generic-content"
                                style="flex: 1; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-input); padding: 1rem; font-size: 0.85rem; line-height: 1.6; white-space: pre-wrap; overflow-y: auto;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Editor controls -->
                <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <span id="messages-save-status"
                            style="font-size: 0.78rem; color: var(--accent); opacity: 0; transition: opacity 0.3s;"></span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn" onclick="messagesDelete()"
                                style="padding: 0.45rem 0.9rem; color: var(--danger);" title="Delete this message">
                                üóëÔ∏è Delete
                            </button>
                            <button class="btn" onclick="messagesDiscard()" style="padding: 0.45rem 0.9rem;">
                                ‚Ü©Ô∏è Discard
                            </button>
                            <button class="btn primary" onclick="messagesSave()" id="messages-save-btn"
                                style="padding: 0.45rem 0.9rem;">
                                üíæ Save
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status terminal -->
    <div class="card full-width" style="margin-top: 1.5rem;">
        <h2><span class="icon">üìü</span> Output</h2>
        <pre class="terminal" id="content-terminal" translate="no">Ready.</pre>
    </div>

    <!-- ‚ïê‚ïê‚ïê VAULT PICKER MODAL ‚ïê‚ïê‚ïê -->
    <div id="vault-picker-overlay" class="vault-picker-overlay" style="display: none;" onclick="closeVaultPicker(event)">
        <div class="vault-picker-modal" onclick="event.stopPropagation()">
            <div class="vault-picker-header">
                <h3 style="margin: 0; font-size: 1rem;">üìé Insert Media</h3>
                <button onclick="closeVaultPicker()" class="vault-picker-close" title="Close">‚úï</button>
            </div>

            <!-- Filter tabs -->
            <div class="vault-picker-tabs">
                <button class="vault-picker-tab active" data-filter="all" onclick="vaultPickerFilter('all', this)">‚ú® All</button>
                <button class="vault-picker-tab" data-filter="image" onclick="vaultPickerFilter('image', this)">üì∏ Images</button>
                <button class="vault-picker-tab" data-filter="video" onclick="vaultPickerFilter('video', this)">üé¨ Video</button>
                <button class="vault-picker-tab" data-filter="audio" onclick="vaultPickerFilter('audio', this)">üéµ Audio</button>
                <button class="vault-picker-tab" data-filter="file" onclick="vaultPickerFilter('file', this)">üìÑ Files</button>
            </div>

            <!-- Gallery grid -->
            <div id="vault-picker-grid" class="vault-picker-grid">
                <div class="loading">Loading media...</div>
            </div>

            <!-- Footer: upload + insert actions -->
            <div class="vault-picker-footer">
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <input type="file" id="vault-picker-file-input" style="display: none;"
                        accept="image/*,video/*,audio/*,application/pdf,text/*,.json,.xml,.eml,.msg,.csv,.md,.zip,.gz,.tar,.7z"
                        onchange="vaultPickerUploadFile(event)">
                    <button class="btn" onclick="document.getElementById('vault-picker-file-input').click()"
                        style="padding: 0.4rem 0.8rem; font-size: 0.82rem;">
                        üì§ Upload new
                    </button>
                    <span id="vault-picker-status" style="font-size: 0.78rem; color: var(--text-dim);"></span>
                </div>
                <div id="vault-picker-actions" style="display: none; gap: 0.5rem;">
                    <button class="btn primary" id="vault-picker-embed-btn" onclick="vaultPickerInsert('embed')"
                        style="padding: 0.45rem 1rem; font-size: 0.85rem;">
                        ‚ñ∂ Embed
                    </button>
                    <button class="btn" id="vault-picker-attach-btn" onclick="vaultPickerInsert('attach')"
                        style="padding: 0.45rem 1rem; font-size: 0.85rem;">
                        üìé Attach
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>