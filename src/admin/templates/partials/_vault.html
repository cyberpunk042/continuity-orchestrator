<!-- Vault Unlock Overlay -->
<div id="vault-overlay" style="
    display: none;
    position: fixed; inset: 0; z-index: 10000;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(20px);
    align-items: center; justify-content: center;
    flex-direction: column;
">
    <div style="
        background: var(--bg-card, #1a1a2e);
        border: 1px solid var(--border, #333);
        border-radius: 16px;
        padding: 2.5rem;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    ">
        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”</div>
        <h2 style="margin: 0 0 0.5rem 0; color: var(--text, #fff); font-size: 1.3rem;">Vault Locked</h2>
        <p style="color: var(--text-dim, #888); font-size: 0.85rem; margin-bottom: 1.5rem;">
            Your .env secrets are encrypted. Enter your vault passphrase to unlock.
        </p>
        <input type="password" id="vault-passphrase-input" placeholder="Vault passphrase"
            autocomplete="off"
            style="
                width: 100%; padding: 0.75rem 1rem; font-size: 1rem;
                border-radius: 8px; border: 1px solid var(--border, #333);
                background: var(--bg-input, #111); color: var(--text, #fff);
                outline: none; margin-bottom: 1rem; box-sizing: border-box;
            "
            onkeydown="if(event.key==='Enter') vaultUnlock();"
        >
        <div id="vault-error" style="color: var(--danger, #ef4444); font-size: 0.82rem; margin-bottom: 0.75rem; display: none;"></div>
        <button onclick="vaultUnlock()" style="
            width: 100%; padding: 0.75rem; font-size: 0.95rem; font-weight: 600;
            border: none; border-radius: 8px; cursor: pointer;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: #000; transition: opacity 0.2s;
        " onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'">
            ğŸ”“ Unlock
        </button>
    </div>
</div>

<!-- Vault Lock Modal -->
<div id="vault-lock-modal" style="
    display: none;
    position: fixed; inset: 0; z-index: 10001;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    align-items: center; justify-content: center;
    flex-direction: column;
">
    <div style="
        background: var(--bg-card, #1a1a2e);
        border: 1px solid var(--border, #333);
        border-radius: 16px;
        padding: 2.5rem;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    ">
        <div id="vault-modal-icon" style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”’</div>
        <h2 id="vault-modal-title" style="margin: 0 0 0.5rem 0; color: var(--text, #fff); font-size: 1.3rem;">Lock Vault</h2>

        <!-- Quick lock section (shown when passphrase is in memory) -->
        <div id="vault-lock-quick" style="display: none;">
            <p style="color: var(--text-dim, #888); font-size: 0.85rem; margin-bottom: 1.25rem;">
                Encrypt your .env secrets using your current passphrase.
            </p>
            <div id="vault-lock-error-quick" style="color: var(--danger, #ef4444); font-size: 0.82rem; margin-bottom: 0.75rem; display: none;"></div>
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.25rem; justify-content: center;">
                <span style="font-size: 0.8rem; color: var(--text-dim, #888);">â± Auto-lock after</span>
                <select id="vault-autolock-select-quick" style="
                    background: var(--bg-input, #111); color: var(--text, #fff);
                    border: 1px solid var(--border, #333); border-radius: 6px;
                    padding: 0.3rem 0.5rem; font-size: 0.8rem; cursor: pointer;
                ">
                    <option value="15">15 min</option>
                    <option value="30" selected>30 min</option>
                    <option value="60">1 hour</option>
                    <option value="0">Disabled</option>
                </select>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                <button onclick="vaultLockCancel()" style="
                    flex: 1; padding: 0.75rem; font-size: 0.9rem;
                    border: 1px solid var(--border, #333); border-radius: 8px;
                    background: transparent; color: var(--text, #fff); cursor: pointer;
                ">Cancel</button>
                <button onclick="vaultQuickLock()" style="
                    flex: 1; padding: 0.75rem; font-size: 0.9rem; font-weight: 600;
                    border: none; border-radius: 8px; cursor: pointer;
                    background: linear-gradient(135deg, #ef4444, #dc2626);
                    color: #fff;
                ">ğŸ”’ Lock Now</button>
            </div>
            <button onclick="vaultShowChangePassphrase()" style="
                background: none; border: none; color: var(--text-dim, #888);
                font-size: 0.78rem; cursor: pointer; text-decoration: underline;
                text-underline-offset: 2px;
            ">Change passphraseâ€¦</button>
        </div>

        <!-- New passphrase section (shown on first lock or when changing) -->
        <div id="vault-lock-new" style="display: none;">
            <p style="color: var(--text-dim, #888); font-size: 0.85rem; margin-bottom: 1.5rem;">
                Choose a passphrase to encrypt your .env secrets.<br>
                <strong>Remember it</strong> â€” you'll need it to unlock.
            </p>
            <input type="password" id="vault-lock-pass1" placeholder="Choose passphrase"
                autocomplete="off"
                style="
                    width: 100%; padding: 0.75rem 1rem; font-size: 1rem;
                    border-radius: 8px; border: 1px solid var(--border, #333);
                    background: var(--bg-input, #111); color: var(--text, #fff);
                    outline: none; margin-bottom: 0.5rem; box-sizing: border-box;
                "
            >
            <input type="password" id="vault-lock-pass2" placeholder="Confirm passphrase"
                autocomplete="off"
                style="
                    width: 100%; padding: 0.75rem 1rem; font-size: 1rem;
                    border-radius: 8px; border: 1px solid var(--border, #333);
                    background: var(--bg-input, #111); color: var(--text, #fff);
                    outline: none; margin-bottom: 1rem; box-sizing: border-box;
                "
                onkeydown="if(event.key==='Enter') vaultLock();"
            >
            <div id="vault-lock-error" style="color: var(--danger, #ef4444); font-size: 0.82rem; margin-bottom: 0.75rem; display: none;"></div>
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; justify-content: center;">
                <span style="font-size: 0.8rem; color: var(--text-dim, #888);">â± Auto-lock after</span>
                <select id="vault-autolock-select" style="
                    background: var(--bg-input, #111); color: var(--text, #fff);
                    border: 1px solid var(--border, #333); border-radius: 6px;
                    padding: 0.3rem 0.5rem; font-size: 0.8rem; cursor: pointer;
                ">
                    <option value="15">15 min</option>
                    <option value="30" selected>30 min</option>
                    <option value="60">1 hour</option>
                    <option value="0">Disabled</option>
                </select>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="vaultLockCancel()" style="
                    flex: 1; padding: 0.75rem; font-size: 0.9rem;
                    border: 1px solid var(--border, #333); border-radius: 8px;
                    background: transparent; color: var(--text, #fff); cursor: pointer;
                ">Cancel</button>
                <button onclick="vaultLock()" style="
                    flex: 1; padding: 0.75rem; font-size: 0.9rem; font-weight: 600;
                    border: none; border-radius: 8px; cursor: pointer;
                    background: linear-gradient(135deg, #ef4444, #dc2626);
                    color: #fff;
                ">ğŸ”’ Lock</button>
            </div>
        </div>

        <!-- Register passphrase section (store passphrase without locking) -->
        <div id="vault-lock-register" style="display: none;">
            <p style="color: var(--text-dim, #888); font-size: 0.85rem; margin-bottom: 1.5rem;">
                Enter your vault passphrase to enable auto-lock.<br>
                Your .env will <strong>not</strong> be encrypted â€” only the passphrase is stored in memory.
            </p>
            <input type="password" id="vault-register-pass" placeholder="Vault passphrase"
                autocomplete="off"
                style="
                    width: 100%; padding: 0.75rem 1rem; font-size: 1rem;
                    border-radius: 8px; border: 1px solid var(--border, #333);
                    background: var(--bg-input, #111); color: var(--text, #fff);
                    outline: none; margin-bottom: 0.5rem; box-sizing: border-box;
                "
            >
            <input type="password" id="vault-register-pass2" placeholder="Confirm passphrase"
                autocomplete="off"
                style="
                    width: 100%; padding: 0.75rem 1rem; font-size: 1rem;
                    border-radius: 8px; border: 1px solid var(--border, #333);
                    background: var(--bg-input, #111); color: var(--text, #fff);
                    outline: none; margin-bottom: 1rem; box-sizing: border-box;
                "
                onkeydown="if(event.key==='Enter') vaultRegisterPassphrase();"
            >
            <div id="vault-register-error" style="color: var(--danger, #ef4444); font-size: 0.82rem; margin-bottom: 0.75rem; display: none;"></div>
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; justify-content: center;">
                <span style="font-size: 0.8rem; color: var(--text-dim, #888);">â± Auto-lock after</span>
                <select id="vault-autolock-select-register" style="
                    background: var(--bg-input, #111); color: var(--text, #fff);
                    border: 1px solid var(--border, #333); border-radius: 6px;
                    padding: 0.3rem 0.5rem; font-size: 0.8rem; cursor: pointer;
                ">
                    <option value="15">15 min</option>
                    <option value="30" selected>30 min</option>
                    <option value="60">1 hour</option>
                    <option value="0">Disabled</option>
                </select>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="vaultLockCancel()" style="
                    flex: 1; padding: 0.75rem; font-size: 0.9rem;
                    border: 1px solid var(--border, #333); border-radius: 8px;
                    background: transparent; color: var(--text, #fff); cursor: pointer;
                ">Cancel</button>
                <button onclick="vaultRegisterPassphrase()" style="
                    flex: 1; padding: 0.75rem; font-size: 0.9rem; font-weight: 600;
                    border: none; border-radius: 8px; cursor: pointer;
                    background: linear-gradient(135deg, #4ade80, #22c55e);
                    color: #000;
                ">ğŸ”‘ Register</button>
            </div>
        </div>
    </div>
</div>

<!-- Vault Registration Banner (non-blocking) -->
<div id="vault-register-banner" style="
    display: none;
    position: fixed; bottom: 1rem; right: 1rem; z-index: 9000;
    background: var(--bg-card, #1a1a2e);
    border: 1px solid var(--warning, #f59e0b);
    border-radius: 12px;
    padding: 1.25rem 1.5rem;
    max-width: 380px;
    width: calc(100% - 2rem);
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    animation: vaultBannerSlideUp 0.3s ease-out;
">
    <style>
        @keyframes vaultBannerSlideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
    <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
        <span style="font-size: 1.5rem; line-height: 1;">ğŸ”</span>
        <div style="flex: 1;">
            <div style="font-size: 0.88rem; font-weight: 600; color: var(--text, #fff); margin-bottom: 0.25rem;">
                Auto-lock unavailable
            </div>
            <div style="font-size: 0.78rem; color: var(--text-dim, #888); margin-bottom: 0.75rem;">
                Register your vault password to enable auto-lock after inactivity.
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="vaultShowRegister()" style="
                    flex: 1; padding: 0.5rem; font-size: 0.8rem; font-weight: 600;
                    border: none; border-radius: 6px; cursor: pointer;
                    background: linear-gradient(135deg, #4ade80, #22c55e);
                    color: #000; transition: opacity 0.2s;
                ">Register</button>
                <button onclick="vaultDismissRegister('session')" style="
                    padding: 0.5rem 0.75rem; font-size: 0.8rem;
                    border: 1px solid var(--border, #333); border-radius: 6px;
                    background: transparent; color: var(--text-dim, #888); cursor: pointer;
                ">Not now</button>
            </div>
            <div style="margin-top: 0.5rem; text-align: right;">
                <button onclick="vaultDismissRegister('permanent')" style="
                    background: none; border: none; color: var(--text-dim, #666);
                    font-size: 0.7rem; cursor: pointer; text-decoration: underline;
                    text-underline-offset: 2px;
                ">Don't ask again</button>
            </div>
        </div>
        <button onclick="vaultDismissRegister('session')" style="
            background: none; border: none; color: var(--text-dim, #666);
            font-size: 1.1rem; cursor: pointer; line-height: 1; padding: 0;
        ">&times;</button>
    </div>
</div>
