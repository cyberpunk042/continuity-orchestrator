    <!-- Debugging Tab -->
    <div id="tab-debugging" class="tab-content">
        <header class="header">
            <h1>ğŸ› Debugging</h1>
            <p class="subtitle">Deadline overrides, archival tools, and testing utilities
            </p>
        </header>

        <div class="grid">
            <div class="card">
                <h2><span class="icon">â°</span> Deadline Management</h2>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div>
                        <label class="form-label" style="margin-bottom: 0.5rem; display: block;">Renew Deadline</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                            <button class="btn" onclick="renewDeadline(24)">+24h</button>
                            <button class="btn primary" onclick="renewDeadline(48)">+48h</button>
                            <button class="btn" onclick="renewDeadline(72)">+72h</button>
                            <span style="color: var(--text-dim); margin: 0 0.25rem;">or</span>
                            <input type="number" id="renew-custom-hours" placeholder="hours" min="1" max="720"
                                style="width: 80px; padding: 0.4rem 0.6rem; background: var(--surface); border: 1px solid var(--border); border-radius: 6px; color: var(--text);" />
                            <button class="btn"
                                onclick="renewDeadline(document.getElementById('renew-custom-hours').value)">Renew</button>
                        </div>
                    </div>
                    <div class="divider" style="border-top: 1px solid var(--border);"></div>
                    <div>
                        <label class="form-label" style="margin-bottom: 0.5rem; display: block;">Set Manual Deadline
                            <span style="color: var(--text-dim); font-size: 0.8rem;">(testing)</span></label>
                        <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                            <input type="datetime-local" id="manual-deadline"
                                style="padding: 0.4rem 0.6rem; background: var(--surface); border: 1px solid var(--border); border-radius: 6px; color: var(--text); color-scheme: dark;" />
                            <button class="btn" onclick="setManualDeadline()">Set Deadline</button>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
                            <button class="btn" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;"
                                onclick="setTestDeadline(3)">âš¡ 3 min</button>
                            <button class="btn" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;"
                                onclick="setTestDeadline(10)">âš¡ 10 min</button>
                            <button class="btn" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;"
                                onclick="setTestDeadline(30)">âš¡ 30 min</button>
                            <button class="btn" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;"
                                onclick="setTestDeadline(60)">âš¡ 1 hour</button>
                        </div>
                    </div>
                    <div id="deadline-status" style="font-size: 0.85rem;"></div>
                    <div class="divider" style="border-top: 1px solid var(--border);"></div>
                    <label
                        style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-dim); cursor: pointer;">
                        <input type="checkbox" id="deadline-git-sync" checked style="accent-color: var(--accent);">
                        ğŸ”„ Git sync after deadline change
                    </label>
                </div>
            </div>

            <div class="card">
                <h2><span class="icon">ğŸ“¦</span> Archive</h2>
                <p style="color: var(--text-dim); font-size: 0.85rem; margin-bottom: 0.75rem;">
                    Save a permanent snapshot to <a href="https://archive.org" target="_blank"
                        style="color: var(--info);">archive.org</a>
                </p>
                <div class="form-group" style="margin-bottom: 0.75rem;">
                    <input type="text" class="form-input" id="archive-url"
                        placeholder="Custom URL (or leave empty for GitHub Pages)">
                </div>
                <div class="actions" style="flex-direction: column;">
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn primary" onclick="archiveNow(true)" style="flex: 1;"
                            title="Archives all pages â€” may take several minutes">
                            ğŸ“¦ Archive All Pages
                        </button>
                        <button class="btn" onclick="archiveNow(false)" style="flex-shrink: 0;"
                            title="Archive only the index page">
                            ğŸ“„ Index Only
                        </button>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn" onclick="checkArchive(true)" style="flex: 1;"
                            title="Check all pages on archive.org">
                            ğŸ” Check All Pages
                        </button>
                        <button class="btn" onclick="checkArchive(false)" style="flex-shrink: 0;"
                            title="Check index only">
                            ğŸ” Index
                        </button>
                    </div>
                </div>
                <div id="archive-status" style="margin-top: 0.75rem; font-size: 0.85rem;"></div>
            </div>

            <div class="card">
                <h2><span class="icon">ğŸ”§</span> State Controls</h2>
                <div class="actions" style="flex-direction: column;">
                    <button class="btn" onclick="resetState()" style="width: 100%;">
                        ğŸ”„ Reset Timer (keep secrets, reset to OK + 48h)
                    </button>
                    <button class="btn danger" onclick="openFactoryResetModal()" style="width: 100%;">
                        ğŸ—‘ï¸ Factory Reset (fresh state + clear audit)
                    </button>
                    <button class="btn" onclick="openBackupModal()" style="width: 100%; margin-top: 0.25rem;">
                        ğŸ“¦ Export / Import
                    </button>
                    <button class="btn" onclick="openVaultModal()" style="width: 100%; margin-top: 0.25rem;">
                        ğŸ” Secrets Vault
                    </button>
                </div>
            </div>
        </div>
    </div>

<!-- Factory Reset Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="factory-reset-modal" style="
    display: none; position: fixed; inset: 0; z-index: 9999;
    background: rgba(0,0,0,0.7); backdrop-filter: blur(6px);
    padding: 2rem; overflow-y: auto;
    justify-content: center; align-items: flex-start;
" onclick="if(event.target===this) closeFactoryResetModal()">
    <div style="
        background: var(--bg-card); border: 1px solid var(--border);
        border-radius: 16px; max-width: 520px; width: 100%;
        padding: 2rem; margin: 3rem auto;
        box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    ">
        <h2 style="margin: 0 0 0.5rem; font-size: 1.3rem;">âš ï¸ Factory Reset</h2>
        <p style="color: var(--text-dim); font-size: 0.88rem; margin-bottom: 1.5rem; line-height: 1.6;">
            This will create a fresh state file, clear the audit log, and reset the system to OK stage.
        </p>

        <!-- Options -->
        <div style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem;">

            <!-- Deadline hours -->
            <div class="form-group" style="margin-bottom: 1rem;">
                <label class="form-label" style="font-size: 0.85rem;">â± Deadline hours</label>
                <input type="number" class="form-input" id="fr-hours" value="48"
                       style="width: 100px;" min="1" max="720">
                <div class="form-hint">Hours until the new deadline (default: 48)</div>
            </div>

            <!-- Backup -->
            <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer; margin-bottom: 1rem; font-size: 0.9rem;">
                <input type="checkbox" id="fr-backup" checked
                       style="width: 18px; height: 18px; accent-color: var(--accent);"
                       onchange="toggleContentOptions()">
                ğŸ’¾ Backup existing state before reset
            </label>

            <hr style="border: none; border-top: 1px solid var(--border); margin: 1rem 0;">

            <!-- Include content -->
            <label style="display: flex; align-items: flex-start; gap: 0.6rem; cursor: pointer; margin-bottom: 0.5rem; font-size: 0.9rem;">
                <input type="checkbox" id="fr-include-content"
                       style="width: 18px; height: 18px; margin-top: 2px; accent-color: var(--warning);"
                       onchange="toggleContentOptions()">
                ğŸ“ Also wipe content
            </label>
            <div id="fr-content-details" style="margin-left: 2rem; font-size: 0.82rem; color: var(--text-dim); line-height: 1.8; display: none;">
                <div id="fr-content-stats">Loading stats...</div>
            </div>

            <!-- Purge history -->
            <div id="fr-purge-group" style="margin-top: 0.75rem; opacity: 0.4; pointer-events: none;">
                <label style="display: flex; align-items: flex-start; gap: 0.6rem; cursor: pointer; font-size: 0.9rem;">
                    <input type="checkbox" id="fr-purge-history"
                           style="width: 18px; height: 18px; margin-top: 2px; accent-color: var(--error);">
                    ğŸ§¹ Purge media from git history
                </label>
                <div style="margin-left: 2rem; font-size: 0.82rem; color: var(--text-dim); line-height: 1.8;">
                    <span id="fr-purge-info"></span>
                </div>
            </div>

            <!-- Scaffold regeneration -->
            <div id="fr-scaffold-group" style="margin-top: 0.75rem; opacity: 0.4; pointer-events: none;">
                <label style="display: flex; align-items: flex-start; gap: 0.6rem; cursor: pointer; font-size: 0.9rem;">
                    <input type="checkbox" id="fr-scaffold" checked
                           style="width: 18px; height: 18px; margin-top: 2px; accent-color: var(--success);">
                    ğŸ“„ Regenerate default articles
                </label>
                <div style="margin-left: 2rem; font-size: 0.82rem; color: var(--text-dim); line-height: 1.6;">
                    Re-creates "How It Works" and "Full Disclosure Statement" after content wipe.
                </div>
            </div>

            <!-- Backup encryption toggle (visible when backup + include-content) -->
            <div id="fr-decrypt-group" style="display: none; margin-top: 1rem; padding: 0.85rem; background: rgba(251, 191, 36, 0.06); border: 1px solid rgba(251, 191, 36, 0.15); border-radius: 8px;">
                <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem;">ğŸ” Backup encryption</div>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem; margin-bottom: 0.4rem;">
                    <input type="radio" name="fr-encrypt-mode" value="encrypted" checked
                           style="accent-color: var(--accent);">
                    Keep encrypted (requires <code>CONTENT_ENCRYPTION_KEY</code> to restore)
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem;">
                    <input type="radio" name="fr-encrypt-mode" value="decrypted"
                           style="accent-color: var(--warning);">
                    Decrypt for backup (plaintext â€” readable without key)
                </label>
                <div style="font-size: 0.78rem; color: var(--text-dim); margin-top: 0.5rem; line-height: 1.5;">
                    Decrypted backups are portable but contain sensitive plaintext. Handle with care.
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem;">
            <button class="btn" onclick="closeFactoryResetModal()" style="min-width: 90px;">
                Cancel
            </button>
            <button class="btn danger" id="fr-submit-btn" onclick="executeFactoryReset()" style="min-width: 120px;">
                ğŸ—‘ï¸ Reset
            </button>
        </div>
    </div>
</div>

<!-- Export / Import Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="backup-modal" style="
    display: none; position: fixed; inset: 0; z-index: 9999;
    background: rgba(0,0,0,0.7); backdrop-filter: blur(6px);
    padding: 2rem; overflow-y: auto;
    justify-content: center; align-items: flex-start;
" onclick="if(event.target===this) closeBackupModal()">
    <div style="
        background: var(--bg-card); border: 1px solid var(--border);
        border-radius: 16px; max-width: 600px; width: 100%;
        padding: 2rem; margin: 2rem auto;
        box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    ">
        <h2 style="margin: 0 0 1.5rem; font-size: 1.3rem;">ğŸ“¦ Export / Import</h2>

        <!-- â”€â”€ Export Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem;">
            <div style="font-weight: 600; margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ“¥ Export</div>
            <p style="color: var(--text-dim); font-size: 0.85rem; margin-bottom: 1rem; line-height: 1.6;">
                Create a portable <code>.tar.gz</code> snapshot. Download it to your machine for safekeeping.
            </p>

            <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer; margin-bottom: 0.5rem; font-size: 0.88rem;">
                <input type="checkbox" id="bk-export-state" checked
                       style="width: 17px; height: 17px; accent-color: var(--accent);">
                State (current.json)
            </label>
            <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer; margin-bottom: 0.5rem; font-size: 0.88rem;">
                <input type="checkbox" id="bk-export-audit" checked
                       style="width: 17px; height: 17px; accent-color: var(--accent);">
                Audit log (ledger.ndjson)
            </label>

            <hr style="border: none; border-top: 1px solid var(--border); margin: 0.75rem 0;">

            <label style="display: flex; align-items: flex-start; gap: 0.6rem; cursor: pointer; margin-bottom: 0.25rem; font-size: 0.88rem;">
                <input type="checkbox" id="bk-export-articles"
                       style="width: 17px; height: 17px; margin-top: 2px; accent-color: var(--warning);"
                       onchange="toggleExportMediaOption()">
                 Content articles
            </label>
            <div id="bk-export-articles-info" style="margin-left: 2rem; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.5rem;"></div>

            <div id="bk-export-media-group" style="opacity: 0.4; pointer-events: none;">
                <label style="display: flex; align-items: flex-start; gap: 0.6rem; cursor: pointer; font-size: 0.88rem;">
                    <input type="checkbox" id="bk-export-media"
                           style="width: 17px; height: 17px; margin-top: 2px; accent-color: var(--warning);">
                    Content media (.enc)
                </label>
                <div id="bk-export-media-info" style="margin-left: 2rem; font-size: 0.8rem; color: var(--text-dim);"></div>
            </div>

            <!-- Encryption toggle -->
            <div id="bk-encryption-toggle" style="display: none; margin-top: 1rem; padding: 0.85rem; background: rgba(251, 191, 36, 0.06); border: 1px solid rgba(251, 191, 36, 0.15); border-radius: 8px;">
                <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem;">ğŸ” Export encryption</div>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem; margin-bottom: 0.4rem;">
                    <input type="radio" name="bk-encrypt-mode" value="encrypted" checked
                           style="accent-color: var(--accent);" onchange="updateEncryptionNotice()">
                    ğŸ”’ Keep encrypted (requires <code>CONTENT_ENCRYPTION_KEY</code> for import)
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem;">
                    <input type="radio" name="bk-encrypt-mode" value="decrypted"
                           style="accent-color: var(--warning);" onchange="updateEncryptionNotice()">
                    ğŸ”“ Decrypt for export (plaintext â€” no key needed)
                </label>
                <div id="bk-encrypt-notice" style="font-size: 0.78rem; margin-top: 0.5rem; line-height: 1.6;">
                </div>
            </div>

            <div style="margin-top: 1rem; text-align: right;">
                <button class="btn" id="bk-export-btn" onclick="doExport()" style="min-width: 160px;">
                    ğŸ“¥ Export &amp; Download
                </button>
            </div>
        </div>

        <!-- â”€â”€ Import Section (additive) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem;">
            <div style="font-weight: 600; margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ“¤ Import <span style="font-weight: normal; font-size: 0.8rem; color: var(--text-dim);">(additive â€” existing items kept)</span></div>
            <p style="color: var(--text-dim); font-size: 0.85rem; margin-bottom: 1rem; line-height: 1.6;">
                Upload an archive to <strong>add</strong> new articles and media. Items that already exist are skipped.
            </p>

            <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
                <label class="btn" style="cursor: pointer; min-width: 140px; text-align: center;">
                    ğŸ“ Choose file...
                    <input type="file" id="bk-import-file" accept=".tar.gz,.gz"
                           style="display: none;" onchange="previewUpload(this)">
                </label>
                <span id="bk-import-filename" style="font-size: 0.85rem; color: var(--text-dim);">No file selected</span>
            </div>

            <div id="bk-import-preview" style="display: none; margin-top: 1rem; padding: 0.85rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; font-size: 0.85rem; line-height: 1.8;">
            </div>

            <div id="bk-import-actions" style="display: none; margin-top: 0.75rem; text-align: right;">
                <button class="btn" id="bk-import-btn" onclick="doImport()" style="min-width: 140px;">
                    ğŸ“¤ Import Content
                </button>
            </div>
        </div>

        <!-- â”€â”€ Local Backups â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem;">
            <div style="font-weight: 600; margin-bottom: 0.75rem; font-size: 0.95rem;">&#128193; Local Backups</div>
            <div id="bk-local-list" style="font-size: 0.85rem; color: var(--text-dim); max-height: 300px; overflow-y: auto;">
                Loading...
            </div>
        </div>

        <!-- Close -->
        <div style="text-align: right; margin-top: 0.5rem;">
            <button class="btn" onclick="closeBackupModal()" style="min-width: 90px;">Close</button>
        </div>
    </div>
</div>

<!-- Secrets Vault Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="vault-modal" style="
    display: none; position: fixed; inset: 0; z-index: 9999;
    background: rgba(0,0,0,0.7); backdrop-filter: blur(6px);
    padding: 2rem; overflow-y: auto;
    justify-content: center; align-items: flex-start;
" onclick="if(event.target===this) closeVaultModal()">
    <div style="
        background: var(--bg-card); border: 1px solid var(--border);
        border-radius: 16px; max-width: 520px; width: 100%;
        padding: 2rem; margin: 3rem auto;
        box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    ">
        <h2 style="margin: 0 0 0.5rem; font-size: 1.3rem;">ğŸ” Secrets Vault</h2>
        <p style="color: var(--text-dim); font-size: 0.85rem; margin-bottom: 1.5rem; line-height: 1.6;">
            Export your <code>.env</code> secrets as a password-protected vault file,
            or import one to restore secrets on a new machine.<br>
            <span style="color: var(--warning); font-size: 0.82rem;">âš ï¸ This file contains ALL your API keys and tokens. Guard it carefully.</span>
        </p>

        <!-- Export Vault -->
        <div style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem;">
            <div style="font-weight: 600; margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ“¥ Export</div>
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                <input type="password" id="vault-export-pw" placeholder="Password (min 8 chars)"
                       style="flex: 1; min-width: 150px; padding: 0.5rem 0.7rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 0.85rem;"
                       oninput="updateVaultPwStrength()">
                <input type="password" id="vault-export-pw2" placeholder="Confirm"
                       style="flex: 1; min-width: 120px; padding: 0.5rem 0.7rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 0.85rem;">
            </div>
            <div id="vault-pw-strength" style="font-size: 0.78rem; color: var(--text-dim); margin-bottom: 0.5rem; min-height: 1.2em;"></div>
            <div style="text-align: right;">
                <button class="btn" id="vault-export-btn" onclick="doVaultExport()" style="min-width: 160px;">
                    ğŸ” Export &amp; Download
                </button>
            </div>
        </div>

        <!-- Import Vault -->
        <div style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem;">
            <div style="font-weight: 600; margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ“¤ Import</div>
            <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; margin-bottom: 0.75rem;">
                <label class="btn" style="cursor: pointer; min-width: 140px; text-align: center;">
                    ğŸ“ Choose .vault file
                    <input type="file" id="vault-import-file" accept=".vault,.json"
                           style="display: none;" onchange="previewVaultUpload(this)">
                </label>
                <span id="vault-import-filename" style="font-size: 0.85rem; color: var(--text-dim);">No file selected</span>
            </div>
            <div id="vault-import-pw-row" style="display: none; margin-bottom: 0.75rem;">
                <input type="password" id="vault-import-pw" placeholder="Vault password"
                       style="width: 100%; padding: 0.5rem 0.7rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 0.85rem;">
            </div>
            <div id="vault-import-diff" style="display: none; margin-bottom: 0.75rem; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; font-size: 0.82rem; max-height: 220px; overflow-y: auto; line-height: 1.7;"></div>
            <div id="vault-import-actions" style="display: none; text-align: right; gap: 0.5rem;">
                <button class="btn" style="min-width: 100px;" onclick="doVaultImportPreview()">
                    ğŸ‘ï¸ Preview
                </button>
                <button class="btn" id="vault-import-btn" onclick="doVaultImport()" style="min-width: 160px;">
                    ğŸ“¤ Import Secrets
                </button>
            </div>
        </div>

        <!-- Close -->
        <div style="text-align: right; margin-top: 0.5rem;">
            <button class="btn" onclick="closeVaultModal()" style="min-width: 90px;">Close</button>
        </div>
    </div>
</div>
