<!-- Factory Reset Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="factory-reset-modal" style="
    display: none; position: fixed; inset: 0; z-index: 9999;
    background: rgba(0,0,0,0.7); backdrop-filter: blur(6px);
    padding: 2rem; overflow-y: auto;
    justify-content: center; align-items: flex-start;
" onclick="if(event.target===this) closeFactoryResetModal()">
    <div style="
        background: var(--bg-card); border: 1px solid var(--border);
        border-radius: 16px; max-width: 520px; width: 100%;
        padding: 2rem; margin: 3rem auto;
        box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    ">
        <h2 style="margin: 0 0 0.5rem; font-size: 1.3rem;">âš ï¸ Factory Reset</h2>
        <p style="color: var(--text-dim); font-size: 0.88rem; margin-bottom: 1.5rem; line-height: 1.6;">
            This will create a fresh state file, clear the audit log, and reset the system to OK stage.
        </p>

        <!-- Options -->
        <div style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem;">

            <!-- Deadline hours -->
            <div class="form-group" style="margin-bottom: 1rem;">
                <label class="form-label" style="font-size: 0.85rem;">â± Deadline hours</label>
                <input type="number" class="form-input" id="fr-hours" value="48"
                       style="width: 100px;" min="1" max="720">
                <div class="form-hint">Hours until the new deadline (default: 48)</div>
            </div>

            <!-- Backup -->
            <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer; margin-bottom: 1rem; font-size: 0.9rem;">
                <input type="checkbox" id="fr-backup" checked
                       style="width: 18px; height: 18px; accent-color: var(--accent);"
                       onchange="toggleContentOptions()">
                ğŸ’¾ Backup existing state before reset
            </label>

            <!-- Reset policy -->
            <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer; margin-bottom: 1rem; font-size: 0.9rem;">
                <input type="checkbox" id="fr-reset-policy"
                       style="width: 18px; height: 18px; accent-color: var(--accent);">
                ğŸ“‹ Reset escalation policy to defaults
            </label>

            <hr style="border: none; border-top: 1px solid var(--border); margin: 1rem 0;">

            <!-- Include content -->
            <label style="display: flex; align-items: flex-start; gap: 0.6rem; cursor: pointer; margin-bottom: 0.5rem; font-size: 0.9rem;">
                <input type="checkbox" id="fr-include-content"
                       style="width: 18px; height: 18px; margin-top: 2px; accent-color: var(--warning);"
                       onchange="toggleContentOptions()">
                ğŸ“ Also wipe content
            </label>
            <div id="fr-content-details" style="margin-left: 2rem; font-size: 0.82rem; color: var(--text-dim); line-height: 1.8; display: none;">
                <div id="fr-content-stats">Loading stats...</div>
            </div>

            <!-- Purge history -->
            <div id="fr-purge-group" style="margin-top: 0.75rem; opacity: 0.4; pointer-events: none;">
                <label style="display: flex; align-items: flex-start; gap: 0.6rem; cursor: pointer; font-size: 0.9rem;">
                    <input type="checkbox" id="fr-purge-history"
                           style="width: 18px; height: 18px; margin-top: 2px; accent-color: var(--error);">
                    ğŸ§¹ Purge media from git history
                </label>
                <div style="margin-left: 2rem; font-size: 0.82rem; color: var(--text-dim); line-height: 1.8;">
                    <span id="fr-purge-info"></span>
                </div>
            </div>

            <!-- Scaffold regeneration -->
            <div id="fr-scaffold-group" style="margin-top: 0.75rem; opacity: 0.4; pointer-events: none;">
                <label style="display: flex; align-items: flex-start; gap: 0.6rem; cursor: pointer; font-size: 0.9rem;">
                    <input type="checkbox" id="fr-scaffold" checked
                           style="width: 18px; height: 18px; margin-top: 2px; accent-color: var(--success);">
                    ğŸ“„ Regenerate default articles
                </label>
                <div style="margin-left: 2rem; font-size: 0.82rem; color: var(--text-dim); line-height: 1.6;">
                    Re-creates "How It Works" and "Full Disclosure Statement" after content wipe.
                </div>
            </div>

            <!-- Backup encryption toggle (visible when backup + include-content) -->
            <div id="fr-decrypt-group" style="display: none; margin-top: 1rem; padding: 0.85rem; background: rgba(251, 191, 36, 0.06); border: 1px solid rgba(251, 191, 36, 0.15); border-radius: 8px;">
                <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem;">ğŸ” Backup encryption</div>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem; margin-bottom: 0.4rem;">
                    <input type="radio" name="fr-encrypt-mode" value="encrypted" checked
                           style="accent-color: var(--accent);">
                    Keep encrypted (requires <code>CONTENT_ENCRYPTION_KEY</code> to restore)
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem;">
                    <input type="radio" name="fr-encrypt-mode" value="decrypted"
                           style="accent-color: var(--warning);">
                    Decrypt for backup (plaintext â€” readable without key)
                </label>
                <div style="font-size: 0.78rem; color: var(--text-dim); margin-top: 0.5rem; line-height: 1.5;">
                    Decrypted backups are portable but contain sensitive plaintext. Handle with care.
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem;">
            <button class="btn" onclick="closeFactoryResetModal()" style="min-width: 90px;">
                Cancel
            </button>
            <button class="btn danger" id="fr-submit-btn" onclick="executeFactoryReset()" style="min-width: 120px;">
                ğŸ—‘ï¸ Reset
            </button>
        </div>
    </div>
</div>
