{% extends "base.html" %}

{% block title %}Continuity Status â€” {{ project }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="assets/css/index.css">
{% endblock %}

{% block body_class %}page-index{% endblock %}

{% block content %}
<header>
    <h1>Continuity Status</h1>
    <p class="subtitle">{{ project }}</p>
</header>

<main>
    <section class="status-card {{ status_class }}">
        <h2>Current Stage: {{ stage }}</h2>
        <p class="status-message">{{ status_message }}</p>
        <p class="timestamp">Last updated: {{ last_updated }}</p>
    </section>

    <table>
        <tr>
            <td>Deadline</td>
            <td><span id="deadline-display">{{ deadline }}</span></td>
        </tr>
        <tr>
            <td>Time Remaining</td>
            <td>{{ time_to_deadline }} minutes (~{{ (time_to_deadline / 60)|round(1) }} hours)</td>
        </tr>
        <tr>
            <td>Mode</td>
            <td>{{ mode }}</td>
        </tr>
    </table>

    <nav>
        <a href="countdown.html">Countdown</a>
        <a href="timeline.html">Timeline</a>
        <a href="status.html">Full Status</a>
        {% if nav_articles %}<a href="articles/">Articles</a>{% endif %}
    </nav>
</main>

<footer>
    <p>Generated: {{ build_time }}</p>
</footer>
{% endblock %}

{% block extra_js %}
<script>
    // Format deadline nicely
    const deadlineEl = document.getElementById("deadline-display");
    if (deadlineEl && deadlineEl.textContent) {
        const d = new Date(deadlineEl.textContent);
        if (!isNaN(d)) {
            deadlineEl.textContent = d.toLocaleString(undefined, {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZoneName: 'short'
            });
        }
    }

    // Strikethrough Deadline and Time Remaining when release is triggered
    if (isReleaseTriggered()) {
        const rows = document.querySelectorAll('table tr');
        rows.forEach(row => {
            const label = row.querySelector('td:first-child');
            if (label && (label.textContent.includes('Deadline') || label.textContent.includes('Time Remaining'))) {
                row.style.textDecoration = 'line-through';
                row.style.opacity = '0.6';
            }
        });
    }
</script>
{% endblock %}